<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supabase 测试</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 500px; margin: 20px auto; padding: 20px; }
        .form-group { margin-bottom: 15px; }
        input, textarea { width: 100%; padding: 8px; margin-top: 5px; box-sizing: border-box; }
        button { background: #4285f4; color: white; border: none; padding: 10px 15px; cursor: pointer; width: 100%; }
        button:disabled { background: #ccc; cursor: not-allowed; }
        #result { margin-top: 15px; padding: 10px; border-radius: 4px; }
        .success { background: #e8f5e9; border-left: 4px solid #4caf50; }
        .error { background: #ffebee; border-left: 4px solid #f44336; }
        #initStatus { margin-bottom: 15px; padding: 10px; }
    </style>
    <!-- 直接加载 Supabase 客户端库 -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body>
    <h2>Supabase 数据测试</h2>
    <div id="initStatus">正在初始化 Supabase 连接...</div>

    <form id="infoForm" style="display:none;">
        <div class="form-group">
            <label for="name">姓名</label>
            <input type="text" id="name" required>
        </div>
        <div class="form-group">
            <label for="phone">电话</label>
            <input type="tel" id="phone" required>
        </div>
        <div class="form-group">
            <label for="address">地址</label>
            <textarea id="address" required></textarea>
        </div>
        <button type="submit" id="submitBtn">提交</button>
    </form>
    <div id="result"></div>

    <script>
        // Supabase 配置
        const SUPABASE_URL = 'https://mtsaxkqjlaiizhhvmizr.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im10c2F4a3FqbGFpaXpoaHZtaXpyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUwODI5MTgsImV4cCI6MjA3MDY1ODkxOH0.EytNoJxOuryMgmfKAXEsEtJ16uwIXuLq0ZsvYgN6Ztk';

        // 全局 Supabase 客户端变量
        let supabaseClient;
        let isInitialized = false;

        // 初始化函数
        function initSupabase() {
            try {
                // 检查 supabase 对象是否已加载
                if (typeof supabase === 'undefined') {
                    throw new Error('Supabase 库未加载成功');
                }

                supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                isInitialized = true;

                document.getElementById('initStatus').textContent = 'Supabase 已连接';
                document.getElementById('infoForm').style.display = 'block';
                console.log('Supabase 初始化完成');
            } catch (error) {
                document.getElementById('initStatus').textContent = '初始化失败: ' + error.message;
                document.getElementById('initStatus').className = 'error';
                console.error('初始化错误:', error);
            }
        }

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 延迟一点确保 supabase 脚本已加载
            setTimeout(initSupabase, 100);
        });

        // 表单提交处理
        document.getElementById('infoForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            if (!isInitialized) {
                showResult('Supabase 未初始化完成，请刷新页面重试', 'error');
                return;
            }

            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = true;
            submitBtn.textContent = '提交中...';

            const name = document.getElementById('name').value;
            const phone = document.getElementById('phone').value;
            const address = document.getElementById('address').value;

            try {
                // 插入数据到 Supabase
                const { data, error } = await supabaseClient
                    .from('orders')
                    .insert([{ name, phone, address }])
                    .select();

                if (error) {
                    console.error('Supabase 错误:', error);
                    throw new Error(error.message);
                }

                showResult(`数据提交成功！ID: ${data[0].id}`, 'success');
                document.getElementById('infoForm').reset();

                // 调试输出
                console.log('提交成功，返回数据:', data);
            } catch (error) {
                console.error('提交错误:', error);
                showResult('提交失败: ' + error.message, 'error');
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = '提交';
            }
        });

        // 显示结果
        function showResult(message, type) {
            const resultDiv = document.getElementById('result');
            resultDiv.textContent = message;
            resultDiv.className = type;
            resultDiv.style.display = 'block';
        }
    </script>
</body>
</html>
